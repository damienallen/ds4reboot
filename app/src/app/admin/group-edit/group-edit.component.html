<section fxFlexAlign="stretch" fxLayout="column">
    <mat-card>
        <div *ngIf="!user?.is_superuser">
            You are not allowed to create a new user. Become admin, or drink a
            beer or two.
        </div>
        <div
            *ngIf="user?.is_superuser"
            class="container"
            fxLayout
            fxLayout.xs="column"
            fxLayoutAlign="center"
            fxLayoutGap="10px"
            fxLayoutGap.xs="0"
        >
            <div class="item item-2" fxFlex>
                <h1 *ngIf="!existingGroup">New Group</h1>
                <h1 *ngIf="existingGroup">Edit <em>{{filteredGroup.name}}</em> - {{filteredGroup.members.length}}
                    members</h1>
                <button mat-flat-button routerLink="/admin/group-manage/">
                    <mat-icon>arrow_back</mat-icon>
                    back to groups
                </button>
                <form [formGroup]="createGroupForm" fxLayout="column">
                    <mat-form-field>
                        <input
                            formControlName="name"
                            matInput
                            placeholder="Group name"
                            required
                            type="text"
                        />
                        <mat-error *ngIf="E('name')?.required">
                            Name is required.
                        </mat-error>
                        <mat-error *ngIf="E('name')?.groupNameExists">
                            This group name is already taken.
                        </mat-error>
                    </mat-form-field>
                    <div
                        *ngFor="let member of createGroupForm.get('members')?.controls; let i = index"
                        formArrayName="members"
                    >
                        <mat-form-field [formGroupName]="i">
                            <mat-select formControlName="member" placeholder="Group member" required>
                                <mat-option *ngFor="let activeUser of activeUsers" [value]="activeUser.id">
                                    {{activeUser.housemate.display_name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <mat-form-field>
                        <mat-select formControlName="newMember" placeholder="Group member" required>
                            <mat-option *ngFor="let activeUser of activeUsers" [value]="activeUser.id">
                                {{activeUser.housemate.display_name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <button
                        (click)="createOrUpdateGroup()"
                        [disabled]="!createGroupForm.valid"
                        color="primary"
                        mat-raised-button
                        type="button"
                    >
                        {{existingGroup ? "Update group" : "Create group"}}
                    </button>
                </form>
            </div>
        </div>
    </mat-card>
</section>
